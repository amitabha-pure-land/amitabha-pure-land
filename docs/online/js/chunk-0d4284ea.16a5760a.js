(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d4284ea"],{"0d49":function(t,s,e){"use strict";var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("b-card",{staticClass:"text-center",attrs:{header:t.module.name}},[e("b-card-text",[e("b-input-group",{staticClass:"mt-3",attrs:{prepend:"总体进度："}},[e("b-form-input",{attrs:{readonly:"",value:t.getStudyProgress()}}),e("b-input-group-append",[e("b-button",{attrs:{variant:"info",href:t.getFullUrl(t.module.url),target:"_blank"}},[e("b-icon",{attrs:{icon:"book"}})],1)],1)],1),e("hr"),t._l(this.submodules,(function(s,a){return e("div",{key:s.id+a},[e("b-link",{attrs:{href:t.getFullUrl(s.url,s),target:"_blank"}},[t._v(t._s("("+s.index+") "+s.name))]),e("b-input-group",{staticClass:"mt-3",attrs:{prepend:"学习进度："}},[e("b-form-input",{attrs:{readonly:"",value:t.toSubmoduleStudyStateString(t.moduleDetails,a)}}),e("b-input-group-append",[e("b-button",{attrs:{variant:"info",href:t.getFullUrl(s.url,s),target:"_blank"}},[e("b-icon",{attrs:{icon:"book"}})],1),t.needToShowPrestudyButton(a)?e("b-button",{attrs:{variant:"success"},on:{click:function(s){return t.updateSubmoduleStudyState(a)}}},[t._v("圆满")]):t._e()],1)],1)],1)}))],2)],1)],1)},o=[],d=e("bf48"),r=e.n(d),n=e("073e"),l={name:"Module",props:{showIncompleted:Boolean,parseModule:{type:Object,required:!0},moduleDetails:{type:Object,required:!0},submodules:{type:Array,required:!0}},data:function(){return{module:this.initModule()}},methods:{initModule(){return{id:this.parseModule.id,name:this.parseModule.get("name"),url:this.parseModule.get("url")}},getFullUrl(t,s){return Object(n["b"])(t,s)},getStudyProgress(){return this.showIncompleted?`未圆满 ${this.moduleDetails.totalSubmodules-this.moduleDetails.completedSubmodules}/${this.moduleDetails.totalSubmodules}`:`已圆满 ${this.moduleDetails.completedSubmodules}/${this.moduleDetails.totalSubmodules}`},toSubmoduleStudyStateString(t,s){if(t&&this.submodules[s].studyRecord){const t=this.submodules[s].studyRecord;if(t.lineage&&t.textbook)return"已圆满"}return"未圆满"},needToShowPrestudyButton(t){if(this.forApplication||this.forAdmin)return!1;const s=this.moduleDetails;if(s&&this.submodules[t].studyRecord){const s=this.submodules[t].studyRecord;return!s.lineage||!s.textbook}return!1},updateSubmoduleStudyState(t){console.log("updateSubmoduleStudyState - "+t);var s="确认已圆满学习?";const e={okText:"确认",cancelText:"取消",loader:!0},a=this.submodules[t],o={title:a.name,body:s},d=this,n={lineage:!0,textbook:!0},l=!this.showIncompleted;this.$dialog.confirm(o,e).then((function(t){r.a.Cloud.run("selfStudy:updateSubmoduleStudyState",{submodule:a,userStudyRecord:n,forDashboard:l}).then(s=>{console.log("updateSubmoduleStudyState - result: "+JSON.stringify(s)),t.close(),d.$emit("submoduleCompleted",{submodule:a,result:s})}).catch(s=>{console.log("error in updateSubmoduleStudyState: "+s),t.close(),d.$dialog.alert("error in updateSubmoduleStudyState: "+s)})})).catch(t=>{console.log("error: "+t)})}}},i=l,u=e("2877"),c=Object(u["a"])(i,a,o,!1,null,null,null);s["a"]=c.exports},"60b6":function(t,s,e){"use strict";e("c87c")},bb51:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[t.isLoadingDashboards?e("div",[t._v("正在获取主页数据...")]):e("div",[e("b-tabs",{attrs:{pills:"","content-class":"mt-3",align:"center"}},[t.home.studentDashboard&&(t.home.studentDashboard.enrolledClasses.length>0||t.home.studentDashboard.newClasses.length>0)?e("b-tab",{attrs:{title:t.studentDashboardTitle(),"title-item-class":"mytab",acitve:""}},[e("StudentDashboard",{attrs:{dashboard:t.home.studentDashboard}})],1):t._e(),t.home.selfStudyDashboard?e("b-tab",{attrs:{title:t.selfStudyDashboardTitle(),"title-item-class":"mytab",acitve:""}},[e("SelfStudyDashboard",{attrs:{dashboard:t.home.selfStudyDashboard}})],1):t._e(),t.home.classAdminDashboard&&t.home.classAdminDashboard.classes.length?e("b-tab",{attrs:{title:t.classAdminDashboardTitle(),"title-item-class":"mytab",acitve:""}},[e("AdminDashboard",{attrs:{dashboard:t.home.classAdminDashboard}})],1):t._e(),t.home.systemAdminDashboard?e("b-tab",{attrs:{title:"全部课程","title-item-class":"mytab",acitve:""}},[e("AdminDashboard",{attrs:{dashboard:t.home.systemAdminDashboard}})],1):t._e()],1)],1)])},o=[],d=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"user-preview"},[0===t.dashboard.modules.length?e("div",{staticClass:"user-preview"},[t._v("\n    您还没有开始闻思！\n    "),e("hr")]):t._e(),t.dashboard.modules.length>0?e("h4",[t._v("正在闻思")]):t._e(),t._l(t.dashboard.modules,(function(s,a){return e("div",{key:s.id+a},[e("Module",{attrs:{parseModule:s,moduleDetails:t.dashboard.moduleDetails[a],submodules:t.dashboard.moduleDetails[a].submodules},on:{submoduleCompleted:t.onSubmoduleCompleted}}),e("b-button",{attrs:{block:"",variant:"info"},on:{click:function(e){return t.showModuleDetails(s)}}},[t._v("查看详情")]),e("hr")],1)})),0===t.dashboard.practices.length?e("div",{staticClass:"user-preview"},[t._v("\n    您还没有开始实修！\n    "),e("hr")]):t._e(),t.dashboard.practices.length>0?e("h4",[t._v("正在实修")]):t._e(),t._l(t.dashboard.practices,(function(s,a){return e("div",{key:s.id+a},[e("Practice",{attrs:{practice:s,latestPracticeCount:t.dashboard.counts[a],practiceSubmodules:t.dashboard.practiceSubmodules[a]}}),e("b-button",{attrs:{block:"",variant:"info"},on:{click:function(e){return t.listPracticeCount(s)}}},[t._v("查看详情")]),e("hr")],1)})),e("b-button",{attrs:{block:"",variant:"warning"},on:{click:function(s){return t.manageSelfStudy()}}},[t._v("自修管理")])],2)},r=[],n=e("0d49"),l=e("569a"),i={name:"SelfStudyDashboard",props:{dashboard:{type:Object,required:!0}},components:{Practice:l["a"],Module:n["a"]},methods:{onSubmoduleCompleted(t){for(var s=0;s<this.dashboard.modules.length;s++)if(this.dashboard.modules[s].id==t.submodule.moduleId){const e=this.dashboard.moduleDetails[s];e.completedSubmodules+=1,console.log(""+JSON.stringify(e)),e.submodules=t.result.userModuleInfo.submodules;break}},showModuleDetails(t){this.$router.push({name:"study-records",params:{moduleId:t.id}})},listPracticeCount(t){this.$router.push({name:"count-list",params:{practiceId:t.id,forAdmin:!1}})},manageSelfStudy(){this.$router.push({name:"self-study-management",params:{}})}}},u=i,c=e("2877"),h=Object(c["a"])(u,d,r,!1,null,null,null),b=h.exports,m=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"user-preview"},[0===t.dashboard.enrolledClasses.length?e("div",{staticClass:"user-preview"},[t._v("\n    您还没有参加任何佛学课程！\n  ")]):t._l(t.dashboard.enrolledClasses,(function(t,s){return e("Class",{key:t.id+s,attrs:{buddhaClass:t}})})),t.dashboard.newClasses.length?e("h2",[t._v("最新共修课程")]):t._e(),t._l(t.dashboard.newClasses,(function(t,s){return e("Class",{key:t.id+s,attrs:{buddhaClass:t,forApplication:!0}})}))],2)},p=[],f=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("h3",{domProps:{textContent:t._s(t.buddhaClass.name)}}),e("h4",[t._v("\n    主持人："+t._s(t.teachers)+" 师兄  \n    "),t.buddhaClass.url?e("a",{attrs:{href:t.getFullUrl(t.buddhaClass.url),target:"_blank"}},[t._v("学习资料")]):t._e(),t.buddhaClass.downloadLink?e("a",{attrs:{href:t.getFullUrl(t.buddhaClass.downloadLink),target:"_blank"}},[t._v("  课堂材料")]):t._e()]),t.buddhaClass.classSnapshot?e("div",[e("b-table",{attrs:{striped:"",hover:"",items:t.items,"thead-class":"hidden_header"}}),e("b-button",{attrs:{block:"",variant:"info"},on:{click:t.listStudent}},[t._v("学员管理")])],1):t._e(),t.forApplication?e("div",[e("b-button",{attrs:{block:"",variant:"info"},on:{click:t.listSession}},[t._v("查看详情")]),e("hr")],1):e("div",[e("div",[e("h4",[t._v("正在闻思")]),0===t.buddhaClass.classSessions.length?e("div",[t._v("\n        还没有开课，敬请期待！\n      ")]):t._e(),t._l(t.buddhaClass.classSessions,(function(s,a){return e("ClassSession",{key:s.id+a,attrs:{classId:t.buddhaClass.id,classSession:s,sessionDetails:t.buddhaClass.sessionDetails[a],forApplication:t.forApplication,forAdmin:void 0!=t.buddhaClass.classSnapshot}})})),e("b-button",{attrs:{block:"",variant:"info"},on:{click:t.listSession}},[t._v("查看详情")]),t.buddhaClass.canDownloadReports?e("b-button",{attrs:{block:"",variant:"info"},on:{click:function(s){return t.downloadReports("dummy")}}},[t._v("闻思进度统计")]):t._e(),e("hr"),t.buddhaClass.practices.length>0?e("h4",[t._v("正在实修")]):t._e(),t._l(t.buddhaClass.practices,(function(s,a){return e("div",{key:s.id+a},[e("Practice",{attrs:{practice:s,latestPracticeCount:t.buddhaClass.counts[a],practiceSubmodules:t.buddhaClass.practiceSubmodules[a],forAdmin:void 0!=t.buddhaClass.classSnapshot}}),e("b-button",{attrs:{block:"",variant:"info"},on:{click:function(e){return t.listPracticeCount(s)}}},[t._v("查看详情")]),t.buddhaClass.canDownloadReports?e("b-button",{attrs:{block:"",variant:"info"},on:{click:function(e){return t.downloadReports(s.id)}}},[t._v("实修统计")]):t._e(),e("hr")],1)}))],2)])])},S=[],v=e("2c634"),C=e("2f62"),_={name:"Class",components:{ClassSession:v["a"],Practice:l["a"]},props:{buddhaClass:{type:Object,required:!0},forApplication:Boolean},data:function(){return{teachers:this.buddhaClass.teachers.join(),items:this.buddhaClass.classSnapshot?[{key:"学生人数",value:this.buddhaClass.classSnapshot.studentCount},{key:"已计划上课",value:this.buddhaClass.classSnapshot.sessionScheduled},{key:" 已完成上课",value:this.buddhaClass.classSnapshot.sessionCompleted}]:[]}},computed:{...Object(C["c"])(["isClassAdmin","isTeachingAssistant"])},methods:{getFullUrl(t){if(!t.includes("://")&&0!==t.indexOf("//")){const s="..";if(!t.startsWith(s))return s+t.replace("..","")}return t},listSession(){this.$router.push({name:"session-management",params:{classId:this.buddhaClass.id,forApplication:this.forApplication,forAdmin:void 0!=this.buddhaClass.classSnapshot,loadingNewSessions:this.isClassAdmin||this.isTeachingAssistant}})},listPracticeCount(t){this.$router.push({name:"count-list",params:{practiceId:t.id,forAdmin:void 0!=this.buddhaClass.classSnapshot}})},listStudent(){this.$router.push({name:"student-management",params:{classId:this.buddhaClass.id}})},downloadReports(t){console.log("downloadReports - practiceId: "+t),this.$router.push({name:"report-management",params:{classId:this.buddhaClass.id,practiceId:t,forAdmin:void 0!=this.buddhaClass.classSnapshot||1==this.buddhaClass.canDownloadReports}})}}},g=_,y=(e("60b6"),Object(c["a"])(g,f,S,!1,null,null,null)),D=y.exports,k={name:"StudentDashboard",props:{dashboard:{type:Object,required:!0}},components:{Class:D}},w=k,A=Object(c["a"])(w,m,p,!1,null,null,null),$=A.exports,O=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"user-preview"},[0===t.dashboard.classes.length?e("div",{staticClass:"user-preview"},[t._v("\n    没有找到任何佛学课程！\n  ")]):t._l(t.dashboard.classes,(function(t,s){return e("Class",{key:t.id+s,attrs:{buddhaClass:t}})}))],2)},j=[],x={name:"AdminDashboard",props:{dashboard:{type:Object,required:!0}},components:{Class:D}},P=x,I=Object(c["a"])(P,O,j,!1,null,null,null),M=I.exports,R=e("6c33"),T=e("4360"),U={name:"Home",components:{SelfStudyDashboard:b,StudentDashboard:$,AdminDashboard:M},methods:{selfStudyDashboardTitle(){return this.currentUser.name+"的自修"},studentDashboardTitle(){return this.currentUser.name+"的共修"},classAdminDashboardTitle(){return`${this.currentUser.name}${this.isStudent?"管理":"辅导"}的课程`}},computed:{...Object(C["c"])(["home","currentUser","isLoadingDashboards","isSystemAdmin","isStudent"])},beforeRouteEnter(t,s,e){console.log("from: "+s.path),s&&s.path&&s.path.startsWith("/home")?e():T["a"].dispatch(R["c"]).then(()=>{e()})}},q=U,E=(e("cccb"),Object(c["a"])(q,a,o,!1,null,null,null));s["default"]=E.exports},c87c:function(t,s,e){},cccb:function(t,s,e){"use strict";e("d563")},d563:function(t,s,e){}}]);
//# sourceMappingURL=chunk-0d4284ea.16a5760a.js.map