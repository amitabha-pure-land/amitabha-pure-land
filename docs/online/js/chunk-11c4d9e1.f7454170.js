(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11c4d9e1"],{"0195":function(e,s,a){"use strict";a.r(s);var t=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",[e.isLoadingStats?a("div",[e._v("正在获取统计信息...")]):a("div",[a("h3",[e._v("\n      "+e._s(e.classInfo.name)+" --\n      "+e._s(e.classInfo.practiceId?e.classInfo.practiceName+"实修统计":"闻思进度统计")+"\n    ")]),e.classInfo.canDownloadClassReport?a("div",[a("DownloadReport",{attrs:{worksheet:e.classInfo.practiceId?"中组"+e.classInfo.practiceName+"统计":"中组出席统计"}})],1):e._e(),e._l(e.classTeams,(function(s,t){return a("div",{key:s.id+s.name+t},[t>0&&s.members.length>0?a("div",[a("ClassTeam",{attrs:{classTeam:s}}),a("DownloadReport",{attrs:{classTeam:s,worksheet:e.classInfo.practiceId?""+s.name+e.classInfo.practiceName+"统计":s.name+"出席统计"}})],1):e._e()])}))],2)])},n=[],c=a("2f62"),l=a("cfac"),r=a("db26"),o=a("6c33"),m=a("4360"),i={name:"ReportManagement",components:{ClassTeam:l["a"],DownloadReport:r["a"]},computed:{...Object(c["c"])(["isLoadingStats","classInfo","classTeams","isClassAdmin","isSystemAdmin"])},beforeRouteEnter(e,s,a){m["a"].dispatch(o["h"],e.params).then(()=>{a()})}},d=i,u=a("2877"),p=Object(u["a"])(d,t,n,!1,null,null,null);s["default"]=p.exports},cfac:function(e,s,a){"use strict";var t=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",[a("b-card",{staticClass:"text-center",attrs:{header:e.classTeam.name}},[e.classTeam.dummy?a("b-card-text",[e._v("\n      将删除 "+e._s(e.classTeam.members.length)+" 名学员\n    ")]):null==e.classTeam.id?a("b-card-text",[e._v("\n      共有 "+e._s(e.classTeam.members.length)+" 名学员未分组\n    ")]):a("b-card-text",[e._v("\n      本组共有 "+e._s(e.classTeam.members.length)+" 名学员\n    ")]),e._l(e.classTeam.members,(function(s,t){return a("b-input-group",{key:s.id+t,staticClass:"mt-3",attrs:{prepend:null==e.classTeam.id||e.classTeam.dummy?"学员：":e.classTeam.dummy||0!=t?"组员：":"组长："}},[e.classInfo.forAdmin?a("b-form-input",{attrs:{readonly:"",value:"("+(t+1)+") "+s.name}}):e.classInfo.practiceId?a("b-form-input",{attrs:{readonly:"",value:"("+(t+1)+") "+s.name+"\t上周："+(s.lastWeek?s.lastWeek.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"未报数")+"\t总计："+(s.count?s.count.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"未报数")+"\n          "}}):a("b-form-input",{attrs:{readonly:"",value:"("+(t+1)+") "+s.name+"\t上周："+s.lastWeek+"\t总计："+s.count+"\n          "}}),e.isClassAdmin&&!e.classInfo.forAdmin&&e.classInfo.practiceId?a("b-button",{attrs:{variant:"success",disabled:s.completed},on:{click:function(s){return e.setCompleted(t)}}},[e._v(e._s(s.completed?"已圆满":"圆满"))]):e._e(),a("b-input-group-append",[e.classInfo.forAdmin?a("div",[null==e.classTeam.id?a("b-form-select",{attrs:{options:e.classTeamOptions},on:{change:function(s){return e.assignTeam(s,t)}},model:{value:s.assignedTeamId,callback:function(a){e.$set(s,"assignedTeamId",a)},expression:"member.assignedTeamId"}}):e._e(),!e.classTeam.dummy&&e.classTeam.id&&t>0?a("b-button",{attrs:{variant:"info"},on:{click:function(s){return e.setLeader(t)}}},[e._v("设为组长")]):e._e(),a("b-button",{attrs:{variant:"warning"},on:{click:function(s){return e.removeMember(t)}}},[e._v(e._s(e.classTeam.dummy?"恢复":"删除"))])],1):e._e()])],1)}))],2)],1)},n=[],c=a("bf48"),l=a.n(c),r=a("2f62"),o=a("6c33"),m={name:"ClassTeam",props:{classTeam:{type:Object,required:!0}},data:function(){return{canAddSubmodule:!1}},computed:{...Object(r["c"])(["isClassAdmin","classInfo","classTeams","classTeamsChanged","classTeamOptions","removedStudents"])},methods:{assignTeam(e,s){console.log(`selected: ${e} index: ${s}`);const a=this.classTeam.members[s];this.classTeam.members.splice(s,1);for(var t=0;t<this.classTeams.length;t++){const e=this.classTeams[t];if(e.id==a.assignedTeamId){a.assignedTeamId=null,e.members.push(a);break}}this.$store.dispatch(o["q"],{changed:!0})},removeMember(e){const s=this.classTeam.members[e];this.classTeam.members.splice(e,1),this.classTeam.id?this.classTeams[0].members.push(s):this.removedStudents.push(s),this.$store.dispatch(o["q"],{changed:!0})},setLeader(e){const s=this.classTeam.members[e];this.classTeam.members.splice(e,1),this.classTeam.members.splice(0,0,s),this.$store.dispatch(o["q"],{changed:!0})},setCompleted(e){const s=this.classTeam.members[e];console.log("setCompleted - "+JSON.stringify(s));var a=`确认${s.name}已圆满${this.classInfo.practiceName}实修?`;const t={okText:"确认",cancelText:"取消",loader:!0},n={title:this.classInfo.practiceName,body:a},c=this;this.$dialog.confirm(n,t).then((function(e){l.a.Cloud.run("admin:markUserPracticeCompleted",{userId:s.id,practiceId:c.classInfo.practiceId}).then(a=>{console.log("markUserPracticeCompleted - result: "+JSON.stringify(a)),s.completed=a.completed,e.close(),window.location.reload()}).catch(s=>{console.log("error in markUserPracticeCompleted: "+s),e.close(),c.$dialog.alert("error in markUserPracticeCompleted: "+s)})})).catch(e=>{console.log("error: "+e)})}}},i=m,d=a("2877"),u=Object(d["a"])(i,t,n,!1,null,null,null);s["a"]=u.exports}}]);
//# sourceMappingURL=chunk-11c4d9e1.f7454170.js.map