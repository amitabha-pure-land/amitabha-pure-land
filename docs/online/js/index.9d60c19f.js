(function(e){function s(s){for(var n,r,i=s[0],u=s[1],c=s[2],d=0,l=[];d<i.length;d++)r=i[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&l.push(o[r][0]),o[r]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);m&&m(s);while(l.length)l.shift()();return a.push.apply(a,c||[]),t()}function t(){for(var e,s=0;s<a.length;s++){for(var t=a[s],n=!0,r=1;r<t.length;r++){var i=t[r];0!==o[i]&&(n=!1)}n&&(a.splice(s--,1),e=u(u.s=t[0]))}return e}var n={},r={index:0},o={index:0},a=[];function i(e){return u.p+"js/"+({}[e]||e)+"."+{"chunk-11c72313":"1db1bea4","chunk-2d0ab43a":"3a00accc","chunk-2d0b652a":"c15184a9","chunk-2d0d6d35":"84e00acd","chunk-2d0d780a":"254feb3e","chunk-2d2086b7":"4bb18bc1","chunk-2d217357":"3f931068","chunk-2d22c101":"0c2a5c7a","chunk-5bf9d480":"fda48878","chunk-0f197549":"82fae26c","chunk-10361307":"86d72eb5","chunk-6e5169e8":"a560c2b2","chunk-496ae192":"8d9e82da","chunk-a32b5246":"8780a4cf","chunk-03323ae8":"31e4a9a7","chunk-00632c3f":"f9d55508","chunk-a841506c":"9732376c","chunk-0d4284ea":"16a5760a","chunk-11c4d9e1":"f7454170","chunk-2d0b6eb6":"e5def51e"}[e]+".js"}function u(s){if(n[s])return n[s].exports;var t=n[s]={i:s,l:!1,exports:{}};return e[s].call(t.exports,t,t.exports,u),t.l=!0,t.exports}u.e=function(e){var s=[],t={"chunk-0f197549":1,"chunk-10361307":1,"chunk-6e5169e8":1,"chunk-496ae192":1,"chunk-00632c3f":1,"chunk-0d4284ea":1};r[e]?s.push(r[e]):0!==r[e]&&t[e]&&s.push(r[e]=new Promise((function(s,t){for(var n="css/"+({}[e]||e)+"."+{"chunk-11c72313":"31d6cfe0","chunk-2d0ab43a":"31d6cfe0","chunk-2d0b652a":"31d6cfe0","chunk-2d0d6d35":"31d6cfe0","chunk-2d0d780a":"31d6cfe0","chunk-2d2086b7":"31d6cfe0","chunk-2d217357":"31d6cfe0","chunk-2d22c101":"31d6cfe0","chunk-5bf9d480":"31d6cfe0","chunk-0f197549":"15cb938a","chunk-10361307":"327eeb89","chunk-6e5169e8":"327eeb89","chunk-496ae192":"e811cada","chunk-a32b5246":"31d6cfe0","chunk-03323ae8":"31d6cfe0","chunk-00632c3f":"e811cada","chunk-a841506c":"31d6cfe0","chunk-0d4284ea":"8ef05e9b","chunk-11c4d9e1":"31d6cfe0","chunk-2d0b6eb6":"31d6cfe0"}[e]+".css",o=u.p+n,a=document.getElementsByTagName("link"),i=0;i<a.length;i++){var c=a[i],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===n||d===o))return s()}var l=document.getElementsByTagName("style");for(i=0;i<l.length;i++){c=l[i],d=c.getAttribute("data-href");if(d===n||d===o)return s()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=s,m.onerror=function(s){var n=s&&s.target&&s.target.src||o,a=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=n,delete r[e],m.parentNode.removeChild(m),t(a)},m.href=o;var f=document.getElementsByTagName("head")[0];f.appendChild(m)})).then((function(){r[e]=0})));var n=o[e];if(0!==n)if(n)s.push(n[2]);else{var a=new Promise((function(s,t){n=o[e]=[s,t]}));s.push(n[2]=a);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,u.nc&&d.setAttribute("nonce",u.nc),d.src=i(e);var l=new Error;c=function(s){d.onerror=d.onload=null,clearTimeout(m);var t=o[e];if(0!==t){if(t){var n=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+r+")",l.name="ChunkLoadError",l.type=n,l.request=r,t[1](l)}o[e]=void 0}};var m=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(s)},u.m=e,u.c=n,u.d=function(e,s,t){u.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:t})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,s){if(1&s&&(e=u(e)),8&s)return e;if(4&s&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(u.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&s&&"string"!=typeof e)for(var n in e)u.d(t,n,function(s){return e[s]}.bind(null,n));return t},u.n=function(e){var s=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(s,"a",s),s},u.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},u.p="/online/",u.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=s,c=c.slice();for(var l=0;l<c.length;l++)s(c[l]);var m=d;a.push([10,"chunk-vendors"]),t()})({0:function(e,s){},"07a3":function(e,s,t){"use strict";var n=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div")},r=[],o={name:"RwvFooter"},a=o,i=t("2877"),u=Object(i["a"])(a,n,r,!1,null,null,null);s["a"]=u.exports},1:function(e,s){},10:function(e,s,t){e.exports=t("56d7")},2:function(e,s){},3:function(e,s){},4:function(e,s){},4360:function(e,s,t){"use strict";var n=t("2b0e"),r=t("2f62"),o=t("bf48"),a=t.n(o),i=t("a65d"),u=t.n(i),c=t("6c33"),d=t("90d2");n["default"].use(u.a);const l={home:{},isLoadingDashboards:!0},m={home(e){return e.home},isLoadingDashboards(e){return e.isLoadingDashboards}},f={[c["c"]]({commit:e}){const s=M.state.auth.user;return console.log(`${c["c"]} - auth.user: ${JSON.stringify(s)}`),e(d["b"]),new Promise((t,r)=>{const o=(new Date).getTime();a.a.Cloud.run("home:loadDashboardsV2",{user:s}).then(s=>{const n=(new Date).getTime();console.log(`${c["c"]} - duration (server): ${s.duration}`),console.log(`${c["c"]} - duration (client): ${n-o}`),e(d["a"],s),t()}).catch(e=>{console.log("error loading dashboards: "+e.message),n["default"].toasted.error("error loading dashboards: "+e.message,{duration:5e3}),r()})})}},h={[d["b"]](e){e.isLoadingDashboards=!0},[d["a"]](e,s){e.home=s,e.isLoadingDashboards=!1}};var g={state:l,getters:m,actions:f,mutations:h};n["default"].use(u.a);const p={errors:null,user:{},isAuthenticated:!1},b={currentUser(e){return e.user},isAuthenticated(e){return e.isAuthenticated},isSystemAdmin(e){return!!e.isAuthenticated&&e.user.roles.some(e=>"B4aAdminUser"==e)},isClassAdmin(e){return!!p.isAuthenticated&&e.user.roles.some(e=>"ClassAdminUser"==e)},isTeachingAssistant(e){return!!e.isAuthenticated&&e.user.roles.some(e=>"TeachingAssistantUser"==e)},isStudent(e){return!!e.isAuthenticated&&e.user.roles.some(e=>"StudentUser"==e)}};var S=function(){const e=document.getElementById("member-func"),s=document.getElementById("non-member-func");e&&s&&(a.a.User.current()?(e.setAttribute("style","display: block;"),s.setAttribute("style","display: none;")):(s.setAttribute("style","display: block;"),e.setAttribute("style","display: none;")))};const v=function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},y={[c["m"]](e,s){console.log(c["m"]);const t=s.email,r=s.password;return new Promise(s=>{a.a.User.logIn(t,r).then(e=>{console.log("user logged in: "+e.id),s(e)}).catch(s=>{n["default"].toasted.error("登录失败！"+s.message,{duration:5e3}),e.commit(d["u"],s.errors)})})},[c["p"]](e,s){return e.commit(d["s"]),new Promise(e=>{a.a.Cloud.run("user:resetPassword",{email:s.email}).then(()=>{n["default"].toasted.show("重置密码请求成功！请登录您的电邮，根据电邮指示设置好新的密码后，再来登录",{icon:"check",duration:5e3}),e()}).catch(e=>{n["default"].toasted.error("重置密码失败！"+e.message,{duration:5e3})})})},[c["n"]](e){e.commit(d["s"])},[c["o"]](e,s){var t=s.name,r=s.email;const o=s.password,i=s.confirmPassword;var u=s.phone;return new Promise((s,c)=>{if(!t)return n["default"].toasted.error("请输入姓名！",{duration:5e3}),void c();if(t=t.trim(),!r)return n["default"].toasted.error("请输入电邮地址！",{duration:5e3}),void c();if(r=r.trim(),!v(r))return n["default"].toasted.error("电邮地址格式错误，请重新输入！",{duration:5e3}),void c();if(!u)return n["default"].toasted.error("请输入电话号码！",{duration:5e3}),void c();if(u=u.trim(),!o||o.length<6)return n["default"].toasted.error("密码不可以少于6位！",{duration:5e3}),void c();if(o!=i)return n["default"].toasted.error("密码和确认密码不匹配！",{duration:5e3}),void c();const l=r.toLowerCase();a.a.Cloud.run("user:signup",{name:t,username:l,email:r,password:o,phone:u}).then(({data:t})=>{n["default"].toasted.show("用户注册成功！请确认您的电邮地址，再来登录",{icon:"check",duration:5e3}),e.commit(d["s"]),s(t)}).catch(s=>{n["default"].toasted.error("用户注册失败！"+s.message,{duration:5e3}),e.commit(d["u"],s.errors),c(s)})})},[c["b"]](e){console.log(`${c["b"]}: ${p.user.id} roles: ${p.user.roles} ${a.a.User.current()?a.a.User.current().id:"no logged in user"}`);const s=a.a.User.current();if(s&&(!p.user||p.user.id!=s.id))return new Promise(t=>{console.log("loading user details: "+s.id),a.a.Cloud.run("user:getRoles",{}).then(s=>{console.log("loaded user details: "+JSON.stringify(s)),e.commit(d["t"],s),t(s)}).catch(s=>{console.log("error loading user details: "+s.message),e.commit(d["s"])})});s||p.user||!p.user.id||e.commit(d["s"])},[c["s"]](e,s){const t=a.a.User.current(),r=s.password,o=s.confirmPassword;return t.set("name",s.name),t.set("phone",s.phone),t.set("username",s.username),t.get("email")!=s.email&&t.set("email",s.email),console.log(`${c["s"]} - loggedInUser: ${JSON.stringify(t)}`),new Promise((a,i)=>{if(r){if(r.length<6)return n["default"].toasted.error("密码不可以少于6位！",{duration:5e3}),void i();if(r!=o)return n["default"].toasted.error("密码和确认密码不匹配！",{duration:5e3}),void i();t.set("password",r),t.unset("state")}t.save().then(e=>{n["default"].toasted.show("更新成功！",{icon:"check",duration:5e3}),s.authState=void 0,s.password=void 0,s.confirmPassword=void 0,r&&(p.user.state=void 0),a(e)}).catch(s=>{n["default"].toasted.error("更新失败！"+s.message,{duration:5e3}),console.log("error updating user: "+JSON.stringify(s)),e.commit(d["u"],s.errors),i()})})}},k={[d["u"]](e,s){p.errors=s},[d["t"]](e,s){console.log(d["t"]),S(),p.isAuthenticated=!0,p.user=s,p.errors={}},async[d["s"]](e){console.log(d["s"]),e.isAuthenticated=!1,e.user={},e.errors={};try{a.a.User.current()&&await a.a.User.logOut().then(()=>{S(),console.log("user logged out")})}catch(s){console.error(s)}}};var w={state:p,actions:y,mutations:k,getters:b},A=t("e894");n["default"].use(u.a);const $={classSession:{},classSessions:[],sessionDetails:[],classInfo:{},practiceInfo:{},isLoadingSessions:!1,isLoadingPracticeCounts:!1,isLoadingStudents:!1,isLoadingStats:!1,classTeams:[],classTeamOptions:[],classAdminUsers:[],removedStudents:[],classTeamsChanged:!1,initComponentKey:0},I={classInfo(e){return e.classInfo},classSession(e){return e.classSession},classSessions(e){return e.classSessions},sessionDetails(e){return e.sessionDetails},isLoadingSessions(e){return e.isLoadingSessions},isLoadingPracticeCounts(e){return e.isLoadingPracticeCounts},isLoadingStudents(e){return e.isLoadingStudents},isLoadingStats(e){return e.isLoadingStats},classTeams(e){return e.classTeams},classTeamsChanged(e){return e.classTeamsChanged},classTeamOptions(e){return e.classTeamOptions},classAdminUsers(e){return e.classAdminUsers},initComponentKey(e){return e.initComponentKey},removedStudents(e){return e.removedStudents},practiceInfo(e){return e.practiceInfo}},U={[c["g"]](e,s){const t=s["classId"];var n=s["forApplication"];"string"===typeof n&&(n="true"===n);var r=s["forAdmin"];"string"===typeof r&&(r="true"===r);var o=s["loadingNewSessions"];"string"===typeof o&&(o="true"===o),console.log(`${c["g"]} - classId: ${t} forApplication: ${n} forAdmin: ${r} loadingNewSessions: ${o}`),e.commit(d["j"]);const i="class:fetchSessionsV2",u=(new Date).getTime();a.a.Cloud.run(i,{classId:t,forApplication:n,forAdmin:r,loadingNewSessions:o}).then(s=>{const t=(new Date).getTime();console.log(`${i} - #classSessions: ${s.classSessions.length}`),console.log(`${i} - duration (server): ${s.duration}`),console.log(`${i} - duration (client): ${t-u}`),e.commit(d["i"],s)}).catch(e=>{throw console.log("error loading classSession list: "+JSON.stringify(e)),new Error(e)})},[c["e"]](e,s){const t=s["practiceId"];var n=s["forAdmin"];"string"===typeof n&&(n="true"===n),console.log(`${c["e"]} - practiceId: ${t} forAdmin: ${n}`),e.commit(d["f"]);const r="class:fetchPracticeCountsV2";a.a.Cloud.run(r,{practiceId:t,forAdmin:n}).then(s=>{console.log(`${c["e"]} - #practiceCount: ${s.counts.length}`),e.commit(d["e"],s)}).catch(e=>{throw console.log("error loading practice counts: "+JSON.stringify(e)),new Error(e)})},[c["k"]](e,s){console.log(`${c["k"]} - filterText: ${JSON.stringify(s)}`),e.commit(d["q"],s)},[c["r"]](e){console.log(`${c["r"]} - classSessionToUpdate: ${JSON.stringify(e)}`)},[c["q"]](e,s){e.commit(d["m"],s)},[c["i"]](e,s){const t=M.state.auth.user,n=s["classId"];console.log(`${c["i"]} - classId: ${n}`),e.commit(d["n"]);const r="class:fetchTeams";a.a.Cloud.run(r,{user:t,classId:n}).then(s=>{console.log(`${r} - #classTeams: ${s.classTeams.length}`),e.commit(d["m"],s)}).catch(e=>{throw console.log("error loading classTeam list: "+JSON.stringify(e)),new Error(e)})},[c["h"]](e,s){const t=M.state.auth.user,n=s["classId"];var r=s["practiceId"],o=s["forAdmin"];"string"===typeof o&&(o="true"===o),"dummy"==r&&(r=void 0),console.log(`${c["h"]} - classId: ${n} practiceId: ${r} forAdmin: ${o}`),e.commit(d["l"]);const i="class:fetchStats";a.a.Cloud.run(i,{user:t,classId:n,practiceId:r,forAdmin:o}).then(s=>{console.log(`${i} - #classTeam: ${s.classTeams.length} lastWeek: ${JSON.stringify(s.lastWeek)}`),e.commit(d["k"],s)}).catch(e=>{throw console.log(`error in ${i}: ${JSON.stringify(e)}`),new Error(e)})}},C={[d["f"]](e){e.isLoadingPracticeCounts=!0},[d["e"]](e,s){e.practiceInfo=s,e.isLoadingPracticeCounts=!1},[d["j"]](e){e.isLoadingSessions=!0},[d["i"]](e,s){e.classInfo=s,e.classSessions=s.classSessions,e.sessionDetails=s.sessionDetails,e.isLoadingSessions=!1},[d["q"]](e,s){if(s&&""!=s){e.classSessions=[],e.sessionDetails=[];for(var t=0;t<e.classInfo.classSessions.length;t++){const n=e.classInfo.classSessions[t];n.get("name").toLowerCase().includes(s.toLowerCase())&&(e.classSessions.push(n),e.sessionDetails.push(e.classInfo.sessionDetails[t]))}}else e.classSessions=e.classInfo.classSessions,e.sessionDetails=e.classInfo.sessionDetails},[d["n"]](e){e.isLoadingStudents=!0},[d["m"]](e,s){if(e.initComponentKey=Math.floor(1e4*Math.random()+1),s.changed)e.classTeamsChanged=!0,e.classTeamOptions=e.classTeams.map(e=>({value:e.id,text:e.name}));else{e.classTeamsChanged=!1,e.classInfo=s,e.removedStudents=[],e.classTeams=s.classTeams.map(e=>{var s={id:e.id,index:e.index,name:e.name,classId:e.classId,leader:e.leader};return s.members=e.members.map(e=>(e.assignedTeamId=null,e)),s}),e.classTeams[0].name="未分组",e.classTeamOptions=e.classTeams.map(e=>({value:e.id?e.id:null,text:e.name})),e.classAdminUsers=[{role:"中组长：",displayName:"待定"},{role:"副组长：",displayName:"待定"},{role:"统计员：",displayName:"待定"}];for(var t=!0,n=0;n<e.classInfo.classAdminStudents.length;n++){const s=e.classInfo.classAdminStudents[n];if(s){var r=2;s.roles.some(e=>"ClassAdminUser"==e)&&(r=t?0:1,t=!1),e.classAdminUsers[r].id=s.id,e.classAdminUsers[r].name=s.name,e.classAdminUsers[r].displayName=`(${r+1}) ${s.name}`}}e.isLoadingStudents=!1}},[d["l"]](e){e.isLoadingStats=!0},[d["k"]](e,s){e.classInfo=s,e.classInfo.canDownloadClassReport=e.classInfo.forAdmin,e.classInfo.forAdmin=!1,e.classTeams=s.classTeams,e.isLoadingStats=!1}};var L={state:$,getters:I,actions:U,mutations:C};n["default"].use(u.a);const T={isLoadingSelfStudy:!1,isLoadingModuleInfo:!1,selfStudyInfo:{},userModuleInfo:{}},P={isLoadingSelfStudy(e){return e.isLoadingSelfStudy},selfStudyInfo(e){return e.selfStudyInfo},userModuleInfo(e){return e.userModuleInfo},isLoadingModuleInfo(e){return e.isLoadingModuleInfo}},O={[c["f"]](e){e.commit(d["h"]);const s="selfStudy:fetchInfo";a.a.Cloud.run(s).then(t=>{console.log(`${s} - selfStudyInfo: ${t}`),e.commit(d["g"],t)}).catch(e=>{throw console.log("error loading selfStudyInfo: "+JSON.stringify(e)),new Error(e)})},[c["d"]](e,s){e.commit(d["d"]);const t="selfStudy:fetchModuleInfo";a.a.Cloud.run(t,{moduleId:s["moduleId"]}).then(s=>{console.log(`${t} - userModuleInfo progress: ${s.completedSubmodules}/${s.totalSubmodules}`),e.commit(d["c"],s)}).catch(e=>{throw console.log("error loading userModuleInfo: "+JSON.stringify(e)),new Error(e)})}},N={[d["h"]](e){e.isLoadingSelfStudy=!0},[d["g"]](e,s){e.selfStudyInfo=s,e.isLoadingSelfStudy=!1},[d["d"]](e){e.isLoadingModuleInfo=!0},[d["c"]](e,s){e.userModuleInfo=s,e.isLoadingModuleInfo=!1}};var D={state:T,getters:P,actions:O,mutations:N};n["default"].use(r["a"]);var M=s["a"]=new r["a"].Store({modules:{home:g,buddhaclass:L,user:A["a"],auth:w,selfstudy:D}})},5:function(e,s){},"56d7":function(e,s,t){"use strict";t.r(s);var n=t("2b0e"),r=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{attrs:{id:"app"}},[t("RwvHeader"),t("router-view"),t("RwvFooter")],1)},o=[],a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return e.isAuthenticated?t("nav",{staticClass:"navbar navbar-light"},[t("div",{staticClass:"container"},[t("router-link",{staticClass:"navbar-brand",attrs:{to:{name:"home"}}},[e._v("主页")]),e.isSystemAdmin?t("router-link",{staticClass:"navbar-brand",attrs:{to:{name:"user-management"}}},[e._v("用户管理")]):e._e(),t("ul",{staticClass:"nav navbar-nav pull-xs-right",staticStyle:{"list-style-type":"none"}},[t("li",{staticClass:"nav-item float-xs-right"},[t("router-link",{staticClass:"nav-link",attrs:{"active-class":"active",exact:"",to:{name:"profile"}}},[t("i",{staticClass:"ion-gear-a"}),e._v("\n           "+e._s(e.currentUser.name)+"\n        ")])],1)])],1)]):e._e()},i=[],u=t("2f62"),c={name:"RwvHeader",computed:{...Object(u["c"])(["currentUser","isAuthenticated","isSystemAdmin","isClassAdmin","isTeachingAssistant","isStudent"])}},d=c,l=t("2877"),m=Object(l["a"])(d,a,i,!1,null,null,null),f=m.exports,h=t("07a3"),g={name:"App",components:{RwvHeader:f,RwvFooter:h["a"]}},p=g,b=Object(l["a"])(p,r,o,!1,null,null,null),S=b.exports,v=t("8c4f");n["default"].use(v["a"]);var y=new v["a"]({routes:[{path:"/",name:"home",component:()=>Promise.all([t.e("chunk-5bf9d480"),t.e("chunk-a32b5246"),t.e("chunk-a841506c"),t.e("chunk-03323ae8"),t.e("chunk-0d4284ea")]).then(t.bind(null,"bb51")),meta:{requiresAuth:!0}},{path:"/user-management",name:"user-management",component:()=>t.e("chunk-2d0b652a").then(t.bind(null,"1d56")),meta:{requiresAuth:!0}},{path:"/sessions/:classId/:forApplication/:forAdmin/:loadingNewSessions",name:"session-management",component:()=>Promise.all([t.e("chunk-5bf9d480"),t.e("chunk-a32b5246"),t.e("chunk-03323ae8"),t.e("chunk-00632c3f")]).then(t.bind(null,"662a")),props:!0,meta:{requiresAuth:!0}},{path:"/students/:classId",name:"student-management",component:()=>t.e("chunk-11c72313").then(t.bind(null,"524f")),props:!0,meta:{requiresAuth:!0}},{path:"/self-study-management",name:"self-study-management",component:()=>t.e("chunk-2d0d780a").then(t.bind(null,"76a6")),props:!0,meta:{requiresAuth:!0}},{path:"/reports/:classId/:practiceId/:forAdmin",name:"report-management",component:()=>Promise.all([t.e("chunk-a32b5246"),t.e("chunk-11c4d9e1")]).then(t.bind(null,"0195")),props:!0,meta:{requiresAuth:!0}},{path:"/records/:moduleId",name:"study-records",component:()=>Promise.all([t.e("chunk-5bf9d480"),t.e("chunk-496ae192")]).then(t.bind(null,"0752")),props:!0,meta:{requiresAuth:!0}},{path:"/counts/:practiceId/:forAdmin",name:"count-list",component:()=>Promise.all([t.e("chunk-a32b5246"),t.e("chunk-a841506c"),t.e("chunk-2d0b6eb6")]).then(t.bind(null,"1ee1")),props:!0,meta:{requiresAuth:!0}},{name:"login",path:"/login",component:()=>t.e("chunk-2d2086b7").then(t.bind(null,"a55b"))},{name:"forgotPassword",path:"/forgotPassword",component:()=>t.e("chunk-2d22c101").then(t.bind(null,"f243"))},{name:"register",path:"/register",component:()=>t.e("chunk-2d0d6d35").then(t.bind(null,"73cf"))},{name:"profile",path:"/profile",meta:{requiresAuth:!0},component:()=>t.e("chunk-2d217357").then(t.bind(null,"c66d"))},{name:"user",path:"/users/:slug",meta:{requiresAuth:!0},component:()=>t.e("chunk-2d0ab43a").then(t.bind(null,"1511")),props:!0},{name:"userCreate",path:"/userCreate",meta:{requiresAuth:!0},component:()=>t.e("chunk-2d0ab43a").then(t.bind(null,"1511"))},{name:"adminFunctions",path:"/adminFunctions",meta:{requiresAuth:!0},component:()=>Promise.all([t.e("chunk-5bf9d480"),t.e("chunk-0f197549"),t.e("chunk-6e5169e8")]).then(t.bind(null,"1041"))},{name:"importData",path:"/importData",meta:{requiresAuth:!0},component:()=>Promise.all([t.e("chunk-5bf9d480"),t.e("chunk-0f197549"),t.e("chunk-10361307")]).then(t.bind(null,"9597"))}]}),k=t("4360"),w=t("bf48"),A=t.n(w),$=t("5f5b"),I=t("b1e0"),U=t("03a5"),C=t.n(U),L=(t("c5c5"),t("5887")),T=t.n(L),P=t("6c33"),O=t("70f2"),N=t.n(O),D=e=>N()(new Date(e),"MMMM D, YYYY"),M=e=>""+e[0];n["default"].config.productionTip=!1,n["default"].filter("date",D),n["default"].filter("error",M),A.a.initialize("ITYDPoZKA1nYeyFaUgPlYM99sDL2I5cNQ7huEKcw","hRETBihNdF7SO9FHM78GxJLbo4cYCuEi4XrrDWED"),A.a.serverURL="https://b4amtf.glitch.me/parse",y.beforeEach((e,s,t)=>{Promise.all([k["a"].dispatch(P["b"])]).then(()=>{k["a"].state.auth&&"needToChangePassword"==k["a"].state.auth.user.state&&"/profile"!=e.path?t({path:"/profile",query:{redirect:e.fullPath}}):e.matched.some(e=>e.meta.requiresAuth)?A.a.User.current()?t():t({path:"/login",query:{redirect:e.fullPath}}):t()})}),n["default"].use($["a"]),n["default"].use(I["a"]),n["default"].use(T.a,{locales:{"zh-CN":{firstDayOfWeek:1,masks:{L:"YYYY年MM月DD日",title:"YYYY年MMM"}}}}),n["default"].use(C.a),new n["default"]({router:y,store:k["a"],render:e=>e(S)}).$mount("#app")},6:function(e,s){},"6c33":function(e,s,t){"use strict";t.d(s,"b",(function(){return n})),t.d(s,"j",(function(){return r})),t.d(s,"l",(function(){return o})),t.d(s,"c",(function(){return a})),t.d(s,"m",(function(){return i})),t.d(s,"p",(function(){return u})),t.d(s,"n",(function(){return c})),t.d(s,"o",(function(){return d})),t.d(s,"s",(function(){return l})),t.d(s,"t",(function(){return m})),t.d(s,"a",(function(){return f})),t.d(s,"g",(function(){return h})),t.d(s,"k",(function(){return g})),t.d(s,"r",(function(){return p})),t.d(s,"e",(function(){return b})),t.d(s,"i",(function(){return S})),t.d(s,"q",(function(){return v})),t.d(s,"h",(function(){return y})),t.d(s,"f",(function(){return k})),t.d(s,"d",(function(){return w}));const n="checkAuth",r="fetchUsers",o="filterUsers",a="fetchDashboards",i="login",u="resetPassword",c="logout",d="register",l="updateUser",m="adminUpdateUser",f="adminFetchUser",h="fetchSessions",g="filterSessions",p="updateSession",b="fetchPracticeCounts",S="fetchStudents",v="resetStudents",y="fetchStats",k="fetchSelfStudy",w="fetchModuleDetails"},7:function(e,s){},8:function(e,s){},9:function(e,s){},"90d2":function(e,s,t){"use strict";t.d(s,"s",(function(){return n})),t.d(s,"t",(function(){return r})),t.d(s,"u",(function(){return o})),t.d(s,"o",(function(){return a})),t.d(s,"p",(function(){return i})),t.d(s,"r",(function(){return u})),t.d(s,"w",(function(){return c})),t.d(s,"v",(function(){return d})),t.d(s,"a",(function(){return l})),t.d(s,"b",(function(){return m})),t.d(s,"j",(function(){return f})),t.d(s,"i",(function(){return h})),t.d(s,"q",(function(){return g})),t.d(s,"f",(function(){return p})),t.d(s,"e",(function(){return b})),t.d(s,"n",(function(){return S})),t.d(s,"m",(function(){return v})),t.d(s,"l",(function(){return y})),t.d(s,"k",(function(){return k})),t.d(s,"h",(function(){return w})),t.d(s,"g",(function(){return A})),t.d(s,"d",(function(){return $})),t.d(s,"c",(function(){return I}));const n="logOut",r="setAuth",o="setError",a="setUsers",i="setLoadingUsers",u="filterUsersInList",c="updateUserInList",d="setUser",l="setDashboards",m="setLoadingDashboards",f="setLoadingSessions",h="setSessions",g="filterSessionsInList",p="setLoadingPracticeCounts",b="setPracticeCounts",S="setLoadingStudents",v="setStudents",y="setLoadingStats",k="setStats",w="setLoadingSelfStudy",A="setSelfStudy",$="setLoadingModuleDetails",I="setModuleInfo"},e894:function(e,s,t){"use strict";var n=t("bf48"),r=t.n(n),o=t("a65d"),a=t.n(o),i=t("2b0e"),u=t("6c33"),c=t("90d2"),d=t("4360");i["default"].use(a.a);const l={user:{},users:[],allUsers:[],isLoadingUsers:!0,usersCount:0},m=function(e){const s=[{name:"StudentUser",displayName:"学员"},{name:"TeacherUser",displayName:"主持人"},{name:"TeachingAssistantUser",displayName:"学修助理"},{name:"ClassAdminUser",displayName:"学修管理员"},{name:"B4aAdminUser",displayName:"系统管理员"}];var t="";if(!e)return s[0].displayName;for(var n=0;n<s.length;n++)e.some(e=>e==s[n].name)&&(t.length>0&&(t+="，"),t+=s[n].displayName);return t},f=function(e){return!e.state&&e.emailVerified?e.name:(s="blocked"==e.state?"账号已禁用":e.emailVerified?"密码需更改":"电邮地址待验证",`${e.name} (${s})`);var s},h={user(e){return e.user},usersCount(e){return e.usersCount},users(e){return e.users},isLoadingUsers(e){return e.isLoadingUsers}},g={[u["j"]]({commit:e}){const s=d["a"].state.auth.user;console.log(`${u["j"]} - auth.user: ${JSON.stringify(s)}`),e(c["p"]);const t="user:adminFetchUsers";r.a.Cloud.run(t,{user:s}).then(s=>{console.log(`${u["j"]} - #users: ${s.users.length}`),e(c["o"],s)}).catch(e=>{throw console.log("error loading user list: "+e.message),new Error(e)})},[u["l"]](e,s){console.log(`${u["l"]} - filterText: ${JSON.stringify(s)}`),e.commit(c["r"],s)},[u["a"]](e,s){if(console.log(`${u["a"]} - userSlug: ${s}`),!s)return void e.commit(c["v"],{});const t=d["a"].state.auth.user;console.log(`${u["a"]} - auth.user: ${JSON.stringify(t)}`);const n="user:adminFetchUser";return new Promise((o,a)=>{r.a.Cloud.run(n,{user:t,userSlug:s}).then(s=>{console.log(`${u["a"]} - user: ${JSON.stringify(s)}`),s.isStudent=0==s.roles.length||s.roles.includes("StudentUser"),s.isTeachingAssistant=s.roles.includes("TeachingAssistantUser"),s.isClassAdmin=s.roles.includes("ClassAdminUser"),s.isSystemAdmin=s.roles.includes("B4aAdminUser"),s.isTeacher=s.roles.includes("TeacherUser"),e.commit(c["v"],s),o()}).catch(e=>{console.log("error loading user: "+e.message),i["default"].toasted.error("Error loading user: "+e.message,{duration:5e3}),a()})})},[u["t"]](e,s){const t=d["a"].state.auth.user;console.log(`${u["t"]} - auth.user: ${JSON.stringify(t)}`),console.log(`${u["t"]} - userToUpdate: ${JSON.stringify(s)}`);const n="user:adminUpdateUser",o=s.password,a=s.confirmPassword,l=d["a"].state.user.allUsers.findIndex(e=>e.id===s.id);return l>=0&&d["a"].state.user.allUsers[l].email===s.email&&(s.email=void 0),console.log(`${l} - userToUpdate: ${JSON.stringify(s)}`),new Promise((u,d)=>o&&o.length<6?(i["default"].toasted.error("密码不可以少于6位！",{duration:5e3}),void d()):o&&o!=a?(i["default"].toasted.error("密码和确认密码不匹配！",{duration:5e3}),void d()):void r.a.Cloud.run(n,{user:t,userToUpdate:s}).then(s=>{e.commit(c["w"],s),i["default"].toasted.show("更新成功！",{icon:"check",duration:5e3}),u()}).catch(e=>{i["default"].toasted.error("更新失败！"+e.message,{duration:5e3}),console.log("error updating user: "+e.message),d()}))}},p={[c["v"]](e,s){e.user=s},[c["p"]](e){e.isLoadingUsers=!0},[c["o"]](e,{users:s,usersCount:t}){e.users=s,e.allUsers=s,e.usersCount=t,e.isLoadingUsers=!1},[c["w"]](e,s){for(var t=!1,n=0,r=0;r<e.allUsers.length;r++){if(e.allUsers[r].id==s.id){t=!0,s.email||(s.email=e.allUsers[r].email),e.allUsers[r]=s;break}s.name>e.allUsers[r].name&&(n=r+1)}t||e.allUsers.splice(n,0,s),e.users=e.allUsers},[c["r"]](e,s){e.users=s&&""!=s?e.allUsers.filter(e=>{const t=f(e),n=m(e.roles),r=`${t}\t${e.username}\t${e.email}\t${e.phone}\t${n}`;return r.toLowerCase().includes(s.toLowerCase())}):e.allUsers}};s["a"]={state:l,getters:h,actions:g,mutations:p,getDisplayRoles:m,getDisplayName:f}}});
//# sourceMappingURL=index.9d60c19f.js.map