(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d780a"],{"76a6":function(t,e,o){"use strict";o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.isLoadingSelfStudy?o("div",[t._v("\n    正在获取自修详情...\n  ")]):o("div",[o("h3",[t._v("自修管理")]),t._l(t.getGroupInfoList(),(function(e,n){return o("div",{key:e.name+n},[o("SelfStudyGroup",{attrs:{groupInfo:e},on:{dataChanged:t.onDataChanged}}),o("hr")],1)})),t.dataChanged?o("b-input-group",{staticClass:"mt-3"},[o("b-form-input",{attrs:{readonly:"",value:"共有 "+t.dataChanged+" 处修改"}}),o("b-input-group-append",[o("b-button",{attrs:{variant:"success"},on:{click:t.submitSelfStudyInfo}},[t._v("保存修改")]),o("b-button",{attrs:{variant:"warning"},on:{click:t.resetSelfStudyInfo}},[t._v("放弃修改")])],1)],1):t._e()],2)])},a=[],i=o("2f62"),d=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-card",{staticClass:"text-center",attrs:{header:t.groupInfo.header}},[o("b-card-text",[t._v("\n      共 "+t._s(t.groupInfo.active.length)+" 个 "+t._s(t.groupInfo.name)+"\n    ")]),t._l(t.groupInfo.active,(function(e,n){return o("b-input-group",{key:e.id+n,staticClass:"mt-3",attrs:{prepend:t.groupInfo.name+"："}},[o("b-form-input",{attrs:{readonly:"",value:"("+(n+1)+") "+e.name}}),o("b-input-group-append",[o("b-button",{attrs:{variant:"success"},on:{click:function(e){return t.removeItem(n,!0)}}},[t._v("圆满")])],1),o("b-input-group-append",[o("b-button",{attrs:{variant:"warning"},on:{click:function(e){return t.removeItem(n,!1)}}},[t._v("删除")])],1)],1)})),o("hr"),o("b-input-group",{staticClass:"mt-3",attrs:{prepend:"未开始("+t.groupInfo.available.length+")："}},[o("b-form-select",{attrs:{options:t.availableItemOptions()},on:{change:function(e){return t.itemToAddChanged()}},model:{value:t.itemToAdd,callback:function(e){t.itemToAdd=e},expression:"itemToAdd"}}),o("b-input-group-append",[t.itemToAddUrl?o("b-button",{attrs:{variant:"info",href:t.itemToAddUrl,target:"_blank"}},[o("b-icon",{attrs:{icon:"book"}})],1):t._e(),o("b-button",{attrs:{variant:"success"},on:{click:function(e){return t.addItem()}}},[t._v("开始")])],1)],1),o("hr"),o("b-input-group",{staticClass:"mt-3",attrs:{prepend:"已圆满("+t.groupInfo.completed.length+")："}},[o("b-form-select",{attrs:{options:t.completedItemOptions()},on:{change:function(e){return t.completedItemToAddChanged()}},model:{value:t.completedItemToAdd,callback:function(e){t.completedItemToAdd=e},expression:"completedItemToAdd"}}),o("b-input-group-append",[t.completedItemToAddUrl?o("b-button",{attrs:{variant:"info",href:t.completedItemToAddUrl,target:"_blank"}},[o("b-icon",{attrs:{icon:"book"}})],1):t._e(),o("b-button",{attrs:{variant:"success"},on:{click:function(e){return t.addCompletedItem()}}},[t._v("开始")])],1)],1)],2)],1)},r=[],l={name:"SelfStudyGroup",props:{groupInfo:{type:Object,required:!0}},data:function(){return{itemToAdd:void 0,itemToAddUrl:void 0,completedItemToAdd:void 0,completedItemToAddUrl:void 0}},computed:{...Object(i["c"])(["selfStudyInfo"])},methods:{completedItemOptions(){const t=this.groupInfo.completed.map(t=>({value:t.id,text:t.name}));return t},availableItemOptions(){const t=this.groupInfo.available.map(t=>({value:t.id,text:t.name}));return t},getFullUrl(t){if(t&&!t.includes("://")&&0!==t.indexOf("//")){const e="..";if(!t.startsWith(e))return e+t.replace("..","")}return t},completedItemToAddChanged(){console.log("addCompletedItem: "+this.completedItemToAdd);for(var t=0;t<this.groupInfo.completed.length;t++){const e=this.groupInfo.completed[t];if(e.id==this.completedItemToAdd){this.completedItemToAddUrl=this.getFullUrl(e.url);break}}},addCompletedItem(){console.log("addCompletedItem: "+this.completedItemToAdd);for(var t=0;t<this.groupInfo.completed.length;t++){const e=this.groupInfo.completed[t];if(e.id==this.completedItemToAdd){this.groupInfo.completed.splice(t,1),this.groupInfo.active.push(e),this.$emit("dataChanged",!0);break}}},itemToAddChanged(){console.log("itemToAdd: "+this.itemToAdd);for(var t=0;t<this.groupInfo.available.length;t++){const e=this.groupInfo.available[t];if(e.id==this.itemToAdd){this.itemToAddUrl=this.getFullUrl(e.url);break}}},addItem(){console.log("addItem: "+this.itemToAdd);for(var t=0;t<this.groupInfo.available.length;t++){const e=this.groupInfo.available[t];if(e.id==this.itemToAdd){this.groupInfo.available.splice(t,1),this.groupInfo.active.push(e),this.$emit("dataChanged",!0);break}}},removeItem(t,e){const o=this.groupInfo.active[t];this.groupInfo.active.splice(t,1),e?this.groupInfo.completed.push(o):this.groupInfo.available.push(o),this.$emit("dataChanged",!0)}}},s=l,u=o("2877"),c=Object(u["a"])(s,d,r,!1,null,null,null),p=c.exports,m=o("6c33"),f=o("4360"),g=o("bf48"),h=o.n(g),I={name:"SelfStudyManagement",components:{SelfStudyGroup:p},computed:{...Object(i["c"])(["isLoadingSelfStudy","selfStudyInfo"])},beforeRouteEnter(t,e,o){f["a"].dispatch(m["f"],t.params).then(()=>{o()})},data:function(){return{groupInfoList:void 0,dataChanged:0}},methods:{onDataChanged(t){this.dataChanged=t?this.dataChanged+1:0},getGroupInfoList(){if(!this.groupInfoList){this.dataChanged=0,this.groupInfoList=[];var t={name:"模块",header:"正在闻思"};t.active=this.selfStudyInfo.modules.map(t=>({id:t._getId(),name:t.get("name"),url:t.get("url")})),t.available=this.selfStudyInfo.availableModules.map(t=>({id:t._getId(),name:t.get("name"),url:t.get("url")})),t.completed=this.selfStudyInfo.completedModules.map(t=>({id:t._getId(),name:t.get("name"),url:t.get("url")})),this.groupInfoList.push(t),t={name:"修法",header:"正在实修"},t.active=this.selfStudyInfo.practices.map(t=>({id:t._getId(),name:t.get("name"),url:t.get("url")})),t.available=this.selfStudyInfo.availablePractices.map(t=>({id:t._getId(),name:t.get("name"),url:t.get("url")})),t.completed=this.selfStudyInfo.completedPractices.map(t=>({id:t._getId(),name:t.get("name"),url:t.get("url")})),this.groupInfoList.push(t)}return this.groupInfoList},resetSelfStudyInfo(){const t={okText:"确认",cancelText:"取消",loader:!0},e={title:this.selfStudyInfo.name,body:"放弃所做修改?"},o=this;this.$dialog.confirm(e,t).then((function(t){o.groupInfoList=void 0,o.getGroupInfoList(),t.close()})).catch(t=>{console.log("error: "+t)})},submitSelfStudyInfo(){const t={okText:"确认",cancelText:"取消",loader:!0},e={title:this.selfStudyInfo.name,body:"保存所做修改?"},o=this;var n={modules:{},practices:{}};n.modules.active=this.groupInfoList[0].active.map(t=>t.id),n.modules.completed=this.groupInfoList[0].completed.map(t=>t.id),n.practices.active=this.groupInfoList[1].active.map(t=>t.id),n.practices.completed=this.groupInfoList[1].completed.map(t=>t.id),console.log("updateSelfStudy - selfStudyInfo: "+JSON.stringify(n)),this.$dialog.confirm(e,t).then((function(t){h.a.Cloud.run("selfStudy:updateInfo",{selfStudyInfo:n}).then(e=>{console.log("updateSelfStudy - result: "+JSON.stringify(e)),o.$router.push({name:"home"}),t.close()}).catch(e=>{console.log("error in updateSelfStudy: "+e),t.close(),o.$dialog.alert("error in updateSelfStudy: "+e)})})).catch(t=>{console.log("error: "+t)})}}},v=I,b=Object(u["a"])(v,n,a,!1,null,null,null);e["default"]=b.exports}}]);
//# sourceMappingURL=chunk-2d0d780a.254feb3e.js.map